<html>
<head>
</head>
<body>
</body>
<script>
const TaskItem = class {
  constructor (title, date) {
    if (!title || typeof title !== 'string') throw new Error('Invalid title');
    this._title = title;
    this._date = date;
    this._isComplted = false;
    this._list = [];
  }
  add (title, date = new Date()) {
    this._list.push(new TaskItem(title, date))
  }
  remove (taskItem) {
    if (!taskItem instanceof TaskItem) throw new Error('Invalid taskItem');
    const list = this._list;
    if (list.includes(taskItem)) list.splice(list.indexOf(taskItem), 1);
  }
  _getList (sort, stateGroup) {
    const list = this._list;
    const s = taskSortRouter[sort];
    return {
      task: this,
      sub: stateGroup ? 
        [
          ...list.filter(task => !task.isCompleted).sort(s),
          ...list.filter(task => task.isCompleted).sort(s)
        ] : [...list].sort(s)
    }
  }
  toggle () {
    this._isComplted = !this._isCompleted;
  }
  sortTitle (taskItem) {
    return this._title - taskItem.title;
  }
  sortDate (taskItem) {
    return this._date - taskItem.date;
  }
  get title () {
    return this._title;
  }
  get date () {
    return this._date;
  }
  get isCompleted () {
    return this._isCompleted;
  }
}
const taskSortRouter = {
  title: (taskItemA, taskItemB) => taskItemA.sortTitle(taskItemB),
  date: (taskItemA, taskItemB) => taskItemA.sortDate(taskItemB)
}
const TaskList = class {
  constructor (title) {
    if (!title || typeof title !== 'string') throw new Error('Invalid title')
    this._title = title;
    this._list = [];
  }
  add (title, date = new Date()) {
    this._list.push(new TaskItem(title, date))
  }
  remove (taskItem) {
    if (!taskItem instanceof TaskItem) throw new Error('Invalid taskItem');
    const list = this._list;
    if (list.includes(taskItem)) list.splice(list.indexOf(taskItem), 1);
  }
  byTitle (stateGroup = true) {
    return this._getList('title', stateGroup);
  }
  byDate(stateGroup = true) {
    return this._getList('date', stateGroup);
  }
  _getList (sort, stateGroup) {
    const list = this._list;
    const s = taskSortRouter[sort];
    const result = stateGroup ? 
    [
      ...list.filter(task => !task.isCompleted).sort(s),
      ...list.filter(task => task.isCompleted).sort(s)
    ] : [...list].sort(s);
    return result.map(v => v._getList(sort, stateGroup));
  }
}
const list1 = new TaskList('Codespitz todo');
list1.add('3강 복습');
list1.add('3강 과제 제출');

const list2 = new TaskList('Design pattern todo');
list2.add('read composite pattern');
list2.add('write composite pattern');

const list  = list2.byDate();
list[1].task.add('write task interface');
list[1].task.add('write renderer');

console.log(list2.byDate());
</script>
</html>